<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="styles.css" rel="stylesheet"/>
    <title>Choropleth Map</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
  </head>
  <body>
    <div id="chart-container"></div>
    <script>
      
      fetch("https://raw.githubusercontent.com/freeCodeCamp/ProjectReferenceData/master/GDP-data.json")
        .then(response => response.json())
        .then(jsonData => {
          drawChart(jsonData.data); 
        });

      function drawChart(data) {
        const width = 900;
        const height = 500;
        const margin = { top: 50, right: 100, bottom: 50, left: 60 };
        const innerWidth = width - margin.left - margin.right;
        const innerHeight = height - margin.top - margin.bottom;

        const svg = d3.select("#chart-container")
          .append("svg")
          .attr("width", width)
          .attr("height", height);

        const dates = data.map(d => new Date(d[0]));

        const xScale = d3.scaleTime()
          .domain([d3.min(dates), d3.max(dates)])
          .range([0, innerWidth]);

        const yScale = d3.scaleLinear()
          .domain([0, d3.max(data, d => d[1])])
          .range([innerHeight, 0]);

        const chart = svg.append("g")
          .attr("transform", `translate(${margin.left},${margin.top})`);

        svg.append("text")
          .attr("id", 'title')
          .attr("x", width / 2)
          .attr("y", margin.top / 2)
          .attr("text-anchor", "middle")
          .attr("fill", "rgb(230,230,230)")
          .text("United States GDP");
        
        // x-axis
        chart.append("g")
          .attr("id", "x-axis")
          .attr("transform", `translate(0, ${innerHeight})`)
          .call(d3.axisBottom(xScale));
        // y-axis
        chart.append("g")
          .attr("id", "y-axis")
          .call(d3.axisLeft(yScale));

        const barWidth = innerWidth / data.length;
        
        // bars
        chart.selectAll("rect")
          .data(data)
          .enter()
          .append("rect")
          .attr("class", "bar")
          .attr("x", d => xScale(new Date(d[0])))
          .attr("y", d => yScale(d[1]))
          .attr("width", barWidth)
          .attr("height", d => innerHeight - yScale(d[1]))
          .attr("fill", "rgb(154, 189, 192)")
          .attr("data-date", d => d[0])
          .attr("data-gdp", d => d[1]);

        const tooltip = d3.select("body")
          .append("div")
          .attr("id", "tooltip")
          .style("position", "absolute")
          .style("visibility", "hidden")
          .style("background-color", "rgb(15, 50, 53)")
          .style("padding", "5px")
          .style("border-radius", "4px");

        chart.selectAll("rect")
          .on("mouseover", function (event, d) {
            tooltip
              .style("visibility", "visible")
              .attr("data-date", d[0])
              .html(`Date: ${d[0]}<br>GDP: $${d[1]} Billion`);
          })
          .on("mousemove", function (event) {
            tooltip
              .style("top", (event.pageY - 50) + "px")
              .style("left", (event.pageX + 10) + "px");
          })
          .on("mouseout", function () {
            tooltip.style("visibility", "hidden");
          });
      }
    </script>
    <style>
      body {
        background-color: rgb(19, 33, 34);
        color: rgb(230,230,230);
        font-family: 'Quicksand', sans-serif;
      }
      #chart-container {
        display: flex;
        justify-content: center; 
        align-items: center;  
        flex-direction: column;
      }
      .tick text {
        font-size: 15px;
      }
    </style>
    <script src="https://cdn.freecodecamp.org/testable-projects-fcc/v1/bundle.js"></script>
  </body>
</html>
